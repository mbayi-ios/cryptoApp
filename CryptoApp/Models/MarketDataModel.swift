//
//  MarketDataModel.swift
//  CryptoApp
//
//  Created by Amby on 02/06/2022.
//


import Foundation

// JSON Data:
/*

 URL: https://api.coingecko.com/api/v3/global

 JSON Response:

 {
   "data": {
     "active_cryptocurrencies": 13486,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 632,
     "total_market_cap": {
       "btc": 43220936.79638403,
       "eth": 708514694.3457427,
       "ltc": 20458200753.881527,
       "bch": 6970881008.509425,
       "bnb": 4265801581.722028,
       "eos": 1021660011061.763,
       "xrp": 3275375080159.487,
       "xlm": 9305073820122.096,
       "link": 186088047430.76715,
       "dot": 136416848234.56192,
       "yfi": 173885974.9824682,
       "usd": 1296786228571.7163,
       "aed": 4763121753268.478,
       "ars": 156025741188544.16,
       "aud": 1804114936913.5422,
       "bdt": 116170820283036.33,
       "bhd": 488913047109.8791,
       "bmd": 1296786228571.7163,
       "brl": 6246359905784.22,
       "cad": 1641420136676.9355,
       "chf": 1245404964623.248,
       "clp": 1068046105713952.6,
       "cny": 8656437111584.763,
       "czk": 30005039756692.344,
       "dkk": 9026364835078.275,
       "eur": 1213421029081.7527,
       "gbp": 1034956011519.4867,
       "hkd": 10174779267307.984,
       "huf": 479697369640436.9,
       "idr": 18773431667541916,
       "ils": 4326021799921.207,
       "inr": 100605331786425.36,
       "jpy": 168477262659249.16,
       "krw": 1621457601398665.2,
       "kwd": 397039633174.2594,
       "lkr": 468852533148109.06,
       "mmk": 2400590345691756.5,
       "mxn": 25477051282388.49,
       "myr": 5696781902115.547,
       "ngn": 538360802791549.5,
       "nok": 12272360818105.969,
       "nzd": 1996176758082.3833,
       "php": 68412605881415.19,
       "pkr": 257903614488211.84,
       "pln": 5570656473524.654,
       "rub": 79525412873587.95,
       "sar": 4861138043568.841,
       "sek": 12710836661641.79,
       "sgd": 1784488077344.1086,
       "thb": 44557574813724.05,
       "try": 21345380131329.59,
       "twd": 38016260880251.25,
       "uah": 38279359354235.016,
       "vef": 129847205066.88571,
       "vnd": 30080869829373990,
       "zar": 20132476519953.008,
       "xdr": 940614813390.8922,
       "xag": 59009206934.310646,
       "xau": 700433145.6384419,
       "bits": 43220936796384.03,
       "sats": 4322093679638403
     },
     "total_volume": {
       "btc": 3354406.555852593,
       "eth": 54988311.49421295,
       "ltc": 1587774995.5551634,
       "bch": 541014857.3403584,
       "bnb": 331071787.2476072,
       "eos": 79291734353.26202,
       "xrp": 254204106993.8676,
       "xlm": 722173162788.1154,
       "link": 14442421024.057882,
       "dot": 10587405178.247929,
       "yfi": 13495409.810293846,
       "usd": 100644468840.48686,
       "aed": 369669146940.48444,
       "ars": 12109264812797.838,
       "aud": 140018597940.26205,
       "bdt": 9016097059441.627,
       "bhd": 37944876997.771454,
       "bmd": 100644468840.48686,
       "brl": 484784277510.8553,
       "cad": 127391742879.53464,
       "chf": 96656733696.08911,
       "clp": 82891790981713.48,
       "cny": 671832022850.9008,
       "czk": 2328711720031.1826,
       "dkk": 700542367254.6824,
       "eur": 94174438516.60715,
       "gbp": 80323646070.31067,
       "hkd": 789671599192.787,
       "huf": 37229641947088.65,
       "idr": 1457018910953402,
       "ils": 335745519695.23663,
       "inr": 7808048818746.2,
       "jpy": 13075635936321.623,
       "krw": 125842436821585.64,
       "kwd": 30814518313.829533,
       "lkr": 36387966746979.21,
       "mmk": 186311463618682.3,
       "mxn": 1977291428180.8552,
       "myr": 442131151616.25854,
       "ngn": 41782551239128.234,
       "nok": 952466342365.0559,
       "nzd": 154924647642.35107,
       "php": 5309549275914.305,
       "pkr": 20016076451395.082,
       "pln": 432342470576.8322,
       "rub": 6172021850353.911,
       "sar": 377276258473.32367,
       "sek": 986496753391.7462,
       "sgd": 138495343904.36124,
       "thb": 3458143949359.1187,
       "try": 1656629595675.214,
       "twd": 2950468087410.499,
       "uah": 2970887340471.201,
       "vef": 10077530664.99793,
       "vnd": 2334596943994106.5,
       "zar": 1562495314301.672,
       "xdr": 73001760962.16508,
       "xag": 4579745032.566581,
       "xau": 54361096.95481223,
       "bits": 3354406555852.593,
       "sats": 335440655585259.3
     },
     "market_cap_percentage": {
       "btc": 44.089872340704325,
       "eth": 17.080567091674233,
       "usdt": 5.596751627118886,
       "usdc": 4.170625513376983,
       "bnb": 3.827807409656985,
       "ada": 1.5060571659188258,
       "xrp": 1.4759561776467642,
       "busd": 1.3933025140610518,
       "sol": 1.0445384954630021,
       "doge": 0.8330577789739293
     },
     "market_cap_change_percentage_24h_usd": -4.700749155667829,
     "updated_at": 1654158742
   }
 }


 */


struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double


    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }

    var marketCap: String {
        if let item = totalMarketCap.first(where: {$0.key == "usd" }){
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }

    var volume: String {
        if let item = totalVolume.first(where: {$0.key == "usd" }){
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }

    var btcDominance: String {
        if let item = marketCapPercentage.first(where:{$0.key == "btc"}) {
            return item.value.asPercentString()
        }
        return ""
    }
}
